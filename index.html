<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Zombie Survival Ultimate</title>
<style>
body{margin:0;background:#000;color:#fff;font-family:Arial;text-align:center}
#hud{display:flex;justify-content:space-around;padding:6px;background:#111}
canvas{border:2px solid lime;display:block;margin:auto;background:#050505}
#shop,#pause,#gameover{
  position:fixed;inset:0;display:none;
  background:rgba(0,0,0,.85);color:#fff
}
.panel{margin-top:80px}
button{padding:10px 20px;margin:6px;font-size:16px;cursor:pointer}
</style>
</head>
<body>

<div id="hud">
  <div id="hp">‚ù§Ô∏è100 üõ°Ô∏è0</div>
  <div id="weapon">Pistol</div>
  <div id="wave">Wave 1</div>
  <div id="score">Score 0</div>
</div>

<canvas id="game" width="900" height="520"></canvas>

<div id="shop">
  <div class="panel">
    <h2>WEAPON SHOP</h2>
    <button onclick="upgrade('damage')">Upgrade Damage</button>
    <button onclick="upgrade('rate')">Upgrade Fire Rate</button>
    <button onclick="upgrade('hp')">Buy Health</button><br>
    <button onclick="closeShop()">Close</button>
  </div>
</div>

<div id="pause"><div class="panel"><h2>PAUSED</h2><button onclick="togglePause()">Resume</button></div></div>
<div id="gameover"><div class="panel"><h1>GAME OVER</h1><button onclick="location.reload()">Restart</button></div></div>

<script>
/* CORE */
const c=document.getElementById("game"),x=c.getContext("2d");
let keys={},paused=false,score=0,wave=1;
let bullets=[],zombies=[],particles=[];
let saved=JSON.parse(localStorage.getItem("zombieSave")||"{}");

/* PLAYER */
const player={
  x:450,y:260,r:15,hp:saved.hp||100,shield:0,
  speed:3,weapon:saved.weapon||"pistol",
  dmg:saved.dmg||20,rate:saved.rate||250
};

/* INPUT */
onkeydown=e=>{
  keys[e.key]=true;
  if(e.key=="b")openShop();
  if(e.key=="p")togglePause();
  if(e.key=="1")player.weapon="pistol";
  if(e.key=="2")player.weapon="rifle";
  if(e.key=="3")player.weapon="shotgun";
};
onkeyup=e=>keys[e.key]=false;
c.onclick=e=>shoot(e);

/* GAME LOOP */
function loop(){
  if(!paused){
    update();
    draw();
  }
  requestAnimationFrame(loop);
}
loop();

/* UPDATE */
function update(){
  movePlayer();moveBullets();moveZombies();collide();
  if(!zombies.length)spawnWave();
}

/* PLAYER MOVE */
function movePlayer(){
  if(keys.w||keys.ArrowUp)player.y-=player.speed;
  if(keys.s||keys.ArrowDown)player.y+=player.speed;
  if(keys.a||keys.ArrowLeft)player.x-=player.speed;
  if(keys.d||keys.ArrowRight)player.x+=player.speed;
}

/* SHOOT */
let last=0;
function shoot(e){
  let now=Date.now();
  if(now-last<player.rate)return;
  last=now;
  let a=Math.atan2(e.offsetY-player.y,e.offsetX-player.x);
  let count=player.weapon=="shotgun"?5:1;
  for(let i=0;i<count;i++){
    bullets.push({
      x:player.x,y:player.y,
      vx:Math.cos(a+(i-2)*.15)*8,
      vy:Math.sin(a+(i-2)*.15)*8
    });
  }
}

/* BULLETS */
function moveBullets(){
  bullets.forEach(b=>{b.x+=b.vx;b.y+=b.vy});
  bullets=bullets.filter(b=>b.x>0&&b.y>0&&b.x<c.width&&b.y<c.height);
}

/* ZOMBIES */
function spawnWave(){
  wave++;
  document.getElementById("wave").innerText="Wave "+wave;
  for(let i=0;i<wave+3;i++)
    zombies.push({
      x:Math.random()*c.width,
      y:Math.random()*c.height,
      hp:40+wave*5,
      sp:1+wave*.1,
      r:15
    });
  if(wave%5==0)spawnBoss();
}
function spawnBoss(){
  zombies.push({x:0,y:0,hp:500,sp:.7,r:40,boss:true});
}
function moveZombies(){
  zombies.forEach(z=>{
    let a=Math.atan2(player.y-z.y,player.x-z.x);
    z.x+=Math.cos(a)*z.sp;
    z.y+=Math.sin(a)*z.sp;
  });
}

/* COLLISION */
function collide(){
  zombies.forEach((z,zi)=>{
    bullets.forEach((b,bi)=>{
      if(Math.hypot(z.x-b.x,z.y-b.y)<z.r){
        z.hp-=player.dmg;
        bullets.splice(bi,1);
        if(z.hp<=0){
          zombies.splice(zi,1);
          score+=z.boss?200:10;
        }
      }
    });
    if(Math.hypot(z.x-player.x,z.y-player.y)<z.r+player.r){
      player.hp-=.4;
      if(player.hp<=0)endGame();
    }
  });
  document.getElementById("hp").innerText=`‚ù§Ô∏è${player.hp|0} üõ°Ô∏è${player.shield}`;
  document.getElementById("score").innerText=`Score ${score}`;
}

/* DRAW */
function draw(){
  x.clearRect(0,0,c.width,c.height);
  x.fillStyle="cyan";
  x.beginPath();x.arc(player.x,player.y,player.r,0,7);x.fill();
  x.fillStyle="yellow";
  bullets.forEach(b=>x.fillRect(b.x,b.y,4,4));
  zombies.forEach(z=>{
    x.fillStyle=z.boss?"purple":"red";
    x.beginPath();x.arc(z.x,z.y,z.r,0,7);x.fill();
  });
}

/* SHOP */
function openShop(){paused=true;shop.style.display="block"}
function closeShop(){paused=false;shop.style.display="none"}
function upgrade(t){
  if(t=="damage")player.dmg+=5;
  if(t=="rate")player.rate=Math.max(80,player.rate-30);
  if(t=="hp")player.hp=Math.min(100,player.hp+20);
}

/* PAUSE */
function togglePause(){
  paused=!paused;
  pause.style.display=paused?"block":"none";
}

/* GAME OVER */
function endGame(){
  localStorage.setItem("zombieSave",JSON.stringify(player));
  gameover.style.display="block";
  paused=true;
}
</script>
</body>
</html>
